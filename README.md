# myPort

### 介绍
通用上位机<br>
可使用串口、tcp服务器和tcp客户端<br>
可自动解析通信协议,通信协议可编写任意多条<br>
可根据协议自动返回命令<br>
可根据解析内容形成曲线<br>
可保存配置<br>
可保存数据<br>
可加载python脚本<br>

#### 界面说明
![介绍](/img/介绍.png "介绍")
用户在**接收参数**区域写入用于接收的参数,在**设置参数**区域写入用于设置的参数.<br>接收到数据之后,软件根据协议配置中的协议来匹配接收参数<br>在发送命令区域填写命令,发送命令中的参数变量可以自动填入设置参数对应的值

#### 协议配置
点击协议配置出现如下界面进行协议配置
![协议配置](/img/协议配置.png "协议配置")
双击空白协议行新增协议
![新增协议](/img/新增协议.png "新增协议")
其中协议名可自定义<br>
协议格式如果带有```%```则表示该项为变量,软件会自动去匹配**接收参数**中的参数,如果```%```后的的名字和**接收参数**中名字相同,则**接收参数**中对应的参数值将会被替换.对于多个字节表示的参数,只需复制相同的名字即可,如上图表示**接收数据**这个参数占4个字节.对于不关心的数据,只需```%+任意名字```即可跳过该变量.<br>
勾选是否回复,可以在接收到和当前协议匹配的数据后回复对应的数据,如上图表示接收到对应协议回复命令名为<回复>的命令
#### 发送命令
双击发送命令中的任意命令打开下图配置
![发送命令](/img/发送命令.png "发送命令")
命令格式用法和协议配置相同,其中%chksum(1,3)表示使用函数,取数组下标为1到3的数据的校验和.<br>
勾选是否连发,软件将会在n毫秒后自动重复发送
#### 接收参数
勾选图像,该参数被匹配时会在**图形**区域生成一条曲线,值为匹配值

#### 脚本
软件支持载入脚本,脚本将会在收到数据时调用dataRec函数,入参为收到的byte数组,脚本需要返回byte数组<br>
脚本将会在准备发送数据时调用dataSend函数,入参为即将发送的byte数组,脚本需要返回byte数组<br>
下列脚本可以将接收到的第一个数据改为0,将发送数组的第一个数据改为0
```
def dataRec(data):
    data[0] = 0;
    return data
def dataSend(data):
    data[0] = 0;
    return data
```
### 测试
导入**bin/Release/测试.myPort**配置,打开本机的777端口作为TCP服务器,发送如下数据
```
FB 01 00 00 00 23 15 FC
```
![测试服务器](/img/测试服务器.png "测试服务器")
![测试](/img/测试.png "测试")

### 软件架构
基于c# winform
使用第三方UI库 [SunnyUI](https://gitee.com/yhuse/SunnyUI)
使用VS2019 社区版进行开发


### 安装教程

打开myPort.exe即可
注意SunnyUI.dll和SunnyUI.Common.dll需要和myPort.exe在同级目录下


### 参与贡献

1.  Fork 本仓库
2.  新建 Feat_xxx 分支
3.  提交代码
4.  新建 Pull Request
